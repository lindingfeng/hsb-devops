#!/usr/bin/env node
'use strict';

const { version } = require('../package.json')
const program = require('commander');
const applyOrder = require('../lib/module/applyOrder');
const { compressTinify } = require('../lib/module/compress');
const { uploadFiles, batchUploadFiles } = require('../lib/upload');
const createTask = require('../lib/module/createTask');
const { run } = require('../index.js')

program
  .version(version)

program
  .command('devops')
  .option('-p, --platform [platform]', '指定发版系统')
  .option('-k, --key [key]', '后台配置的key')
  .action(({ platform, key }) => {
    platform === 'prod' && applyOrder(key)
    platform === 'new' && createTask(key)
  })

program
  .command('compressTinify')
  .option('-k, --key [key]', '后台配置的密钥key')
  .action(({ key }) => {
    key && compressTinify(key)
  })

program
  .command('upload')
  .option('-d, --dir [dir]', 'CDN目录')
  .action(({ dir }) => {
    if (dir) {
      return batchUploadFiles(`/${dir}`)
    }
    uploadFiles()
  })

program
  .command('init')
  .action(() => {
    run && run()
  })

program
  .parse(process.argv);